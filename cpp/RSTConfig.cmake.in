GET_FILENAME_COMPONENT(RST_CONFIG_DIR "${CMAKE_CURRENT_LIST_FILE}" PATH)

SET(DOMAINS @DOMAINS@)

# Introspection interface:
# * Domains
# * Formats
# * Mapping targets
# * Schema files
#   * Data type definitions
#   * Mappings
#   * Package documentation

SET(RST_DOMAINS         @DOMAINS@)
SET(RST_FORMATS         @FORMATS@)
SET(RST_MAPPING_TARGETS @MAPPING_TARGETS@)

SET(RST_STABLE_PROTO_FILES     @STABLE_PROTO_FILES@)
SET(RST_STABLE_PROTO_PACKAGES  @STABLE_PROTO_PACKAGES@)
SET(RST_STABLE_LCM_FILES       @STABLE_LCM_FILES@)
SET(RST_STABLE_LCM_PACKAGES    @STABLE_LCM_PACKAGES@)

SET(RST_SANDBOX_PROTO_FILES    @SANDBOX_PROTO_FILES@)
SET(RST_SANDBOX_PROTO_PACKAGES @SANDBOX_PROTO_PACKAGES@)
SET(RST_SANDBOX_LCM_FILES      @SANDBOX_LCM_FILES@)
SET(RST_SANDBOX_LCM_PACKAGES   @SANDBOX_LCM_PACKAGES@)

SET(RST_SCHEMA_STABLE_ROOT  ${RST_CONFIG_DIR}/schema/stable)
SET(RST_SCHEMA_SANDBOX_ROOT ${RST_CONFIG_DIR}/schema/sandbox)

FOREACH(DOMAIN ${DOMAINS})
    FOREACH(FORMAT ${FORMATS})
        STRING(TOLOWER ${DOMAIN} DOMAIN_LOWER)
        STRING(TOLOWER ${FORMAT} FORMAT_LOWER)

        SET(RST_${DOMAIN}_${FORMAT}_ROOT "${RST_CONFIG_DIR}/${DOMAIN_LOWER}/${FORMAT_LOWER}")

        # Ordinary message description files.
        SET(RST_${DOMAIN}_${FORMAT}_FILES)
        FOREACH(F ${${DOMAIN}_${FORMAT}_FILES_REL})
            LIST(APPEND RST_${DOMAIN}_${FORMAT}_FILES "${RST_CONFIG_DIR}/${F}")
        ENDFOREACH()

        # Package description files.
        SET(RST_${DOMAIN}_${FORMAT}_PACKAGES)
        FOREACH(F ${${DOMAIN}_${FORMAT}_PACKAGES_REL})
            LIST(APPEND RST_${DOMAIN}_${FORMAT}_PACKAGES "${RST_CONFIG_DIR}/${F}")
        ENDFOREACH()

ENDFOREACH()

# Backward compatibility
#   RST_STABLE_PROTO_ROOT  is already set
SET(RST_STABLE_PROTOS      "${RST_STABLE_PROTO_FILES}")
SET(RST_STABLE_PACKAGES    "${RST_STABLE_PROTO_PACKAGES}")

#   RST_SANDBOX_PROTO_ROOT is already set
SET(RST_SANDBOX_PROTOS     "${RST_SANDBOX_PROTO_FILES}")
SET(RST_SANDBOX_PACKAGES   "${RST_SANDBOX_PROTO_PACKAGES}")

# Backward compatibility
#   RST_STABLE_PROTO_ROOT  is already set
SET(RST_STABLE_PROTOS      "${RST_STABLE_PROTO_FILES}")
SET(RST_STABLE_PACKAGES    "${RST_STABLE_PROTO_PACKAGES}")

#   RST_SANDBOX_PROTO_ROOT is already set
SET(RST_SANDBOX_PROTOS     "${RST_SANDBOX_PROTO_FILES}")
SET(RST_SANDBOX_PACKAGES   "${RST_SANDBOX_PROTO_PACKAGES}")

# determine whether the sandbox is required
SET(USE_SANDBOX FALSE)
FOREACH(COMPONENT ${RST_FIND_COMPONENTS})
    IF(COMPONENT STREQUAL "sandbox")
        SET(USE_SANDBOX TRUE)
    ELSE()
        MESSAGE(SEND_ERROR "Unknown component ${COMPONENT} requested")
    ENDIF()
ENDFOREACH()

IF(EXISTS "${RST_CONFIG_DIR}/../CMakeCache.txt")
    INCLUDE("${RST_CONFIG_DIR}/RSTBuildTreeSettings.cmake")
ELSE()

    SET(RST_INCLUDE_DIRS "${RST_CONFIG_DIR}/../../include/@INSTALL_PREFIX@/stable")
    SET(RST_RUNTIME_LIBRARY_DIRS "${RST_CONFIG_DIR}/../../bin")

    # sandbox additions
    IF(USE_SANDBOX)
        LIST(APPEND RST_INCLUDE_DIRS "${RST_CONFIG_DIR}/../../include/@INSTALL_PREFIX@/sandbox")
    ENDIF()

ENDIF()

SET(RSC_DIR "@RSC_DIR@" CACHE PATH "RSC location")
FIND_PACKAGE(RSC REQUIRED)
SET(CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} "${RSC_CMAKE_MODULE_PATH}")

SET(PROTOBUF_ROOT "@PROTOBUF_ROOT@" CACHE PATH "Protobuf location")

LIST(APPEND RST_INCLUDE_DIRS         ${RSC_INCLUDE_DIRS} ${PROTOBUF_INCLUDE_DIR})
LIST(APPEND RST_RUNTIME_LIBRARY_DIRS ${RSC_RUNTIME_LIBRARY_DIRS} ${PROTOBUF_RUNTIME_LIBRARY_DIRS})

# Expose RST library as an imported target (from the point of view
# of the downstream project)
IF(NOT RST_CONFIG_PROCESSED)
    SET(RST_CONFIG_PROCESSED TRUE)
    INCLUDE("${RST_CONFIG_DIR}/RSTDepends.cmake")
ENDIF()
SET(RST_LIBRARIES @STABLE_NAME@)
SET(RST_CFLAGS "@RSTSTABLE_CFLAGS@")

# invariant sandbox additions
IF(USE_SANDBOX)
    LIST(APPEND RST_LIBRARIES "@SANDBOX_NAME@")
    LIST(APPEND RST_CFLAGS    "@RSTSANDBOX_CFLAGS@")
ENDIF()
